<div class="row h-100 flex-grow-1">
  <div id="sidenav" class="col-1 d-flex flex-column">
    <app-sidenav class="h-100"></app-sidenav>
  </div>
  <div
    class="flex-grow-1 col-12 col-xl-11 px-0 px-xl-5 d-flex flex-column justify-content-start position-relative"
  >
    <div class="d-flex align-items-center justify-content-between">
      <h2 class="display-4">Dettagli appuntamento</h2>
      <div
        class="d-flex gap-2"
        *ngIf="appointment && !isDoctor && appointment.status == 'PENDING'"
      >
        <app-btn-primary-filled
          [type]="'button'"
          [title]="'Modifica la visita'"
          (onClick)="openCalendar()"
        >
          Modifica la visita
        </app-btn-primary-filled>
        <app-btn-danger-filled
          [type]="'button'"
          [title]="'Annulla appuntamento'"
          (onClick)="cancel(appointment.id)"
          >Annulla</app-btn-danger-filled
        >
      </div>
    </div>
    <ng-container *ngIf="appointment">
      <div class="border-bottom border-1 pb-3 mb-3">
        <h6 class="fw-bolder fs-3 mb-3">Medico</h6>
        <div class="d-flex gap-3">
          <img
            [src]="
              appointment.doctor.avatar
                ? appointment.doctor.avatar
                : 'https://ui-avatars.com/api/?name=' +
                  appointment.doctor.name +
                  '+' +
                  appointment.doctor.surname
            "
            class="w-fixed-100 rounded-1"
            alt="profile image"
          />
          <div>
            <p class="fw-bold mb-0">
              {{ appointment.doctor.name }} {{ appointment.doctor.surname }}
            </p>
            <p>{{ appointment.doctor.title }}</p>
            <p class="fs-sm mb-0 d-flex align-items-center gap-2">
              <ng-icon name="ionMailOutline"></ng-icon>
              {{ appointment.doctor.email }}
            </p>
            <p class="fs-sm d-flex align-items-center gap-2">
              <ng-icon name="ionCallOutline"></ng-icon>
              {{ appointment.doctor.phoneNumber }}
            </p>
          </div>
        </div>
      </div>
      <div class="border-bottom border-1 pb-3 mb-3">
        <div class="d-flex align-items-center justify-content-between mb-3">
          <h6 class="fw-bolder d-flex align-items-center gap-3 fs-3 mb-0">
            <ng-icon name="ionCalendarOutline"></ng-icon> Data e ora
          </h6>
          <div class="d-flex gap-2 align-items-center">
            <app-btn-dark-filled
              *ngIf="appointment.status == 'PENDING'"
              [type]="'button'"
              (onClick)="confirm(appointment.id)"
              >Conferma</app-btn-dark-filled
            >
            <app-btn-danger-filled
              *ngIf="isDoctor"
              [type]="'button'"
              (onClick)="cancel(appointment.id)"
              >Annulla</app-btn-danger-filled
            >
          </div>
        </div>

        <div class="d-flex align-items-center gap-3">
          <p class="fs-4 mb-0">
            {{
              appointment.startDate | date : "EEEE dd/MM/yyyy HH:mm" | titlecase
            }}
          </p>

          <span
            class="text-center d-block rounded-1 px-1 fs-sm fw-bold"
            [ngClass]="{
              pending: appointment.status === 'PENDING',
              confirmed: appointment.status === 'CONFIRMED',
              cancelled: appointment.status === 'CANCELLED'
            }"
            >{{ translateStatus(appointment.status) }}</span
          >
        </div>
      </div>
      <div class="border-bottom border-1 pb-3 mb-3">
        <div class="d-flex align-items-start justify-content-between">
          <div>
            <h6 class="fw-bolder d-flex align-items-center gap-3 fs-3 mb-3">
              <ng-icon name="ionLocationOutline"></ng-icon> Indirizzo
            </h6>

            <p *ngIf="appointment && appointment.address">
              {{ appointment.address.street }},
              {{ appointment.address.streetNumber }} -
              {{ appointment.address.city }}
              {{ appointment.address.provinceAcronym }}
              {{ appointment.address.postalCode }}
            </p>
            <p *ngIf="!appointment.address">Indirizzo non disponibile</p>
          </div>
          <app-map
            *ngIf="appointment && appointment.address"
            [address]="getAddress(appointment.address)"
            [width]="'250'"
            [height]="'100'"
          ></app-map>
        </div>
      </div>
      <div class="pb-3 mb-3">
        <h6 class="fw-bolder d-flex align-items-center gap-3 fs-3 mb-3">
          <ng-icon name="ionGitNetworkOutline"></ng-icon> Prestazione prenotata
        </h6>
        <div class="d-flex align-items-start gap-3">
          <div>
            <div class="d-flex align-items-center gap-3 mb-2">
              <p class="mb-0 fw-bold">{{ appointment.service.name }}</p>
              <p class="mb-0">{{ appointment.service.price }},00â‚¬</p>
            </div>
            <p class="mb-0 fs-sm">{{ appointment.service.description }}</p>
          </div>
        </div>
      </div>
    </ng-container>
  </div>
</div>
